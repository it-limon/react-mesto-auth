(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{28:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(19),s=n.n(r),i=n(7),o=(n(28),n(22)),l=n(4),u=n(2),d=n(3),b=Object(a.createContext)(),j=n(0);var m=function(e){var t=e.data,n=t.name,c=t.link,r=t.likes,s=t.owner,i=Object(a.useContext)(b).currentUser,o=s._id===i._id,l=r.some((function(e){return e._id===i._id}));return Object(j.jsxs)("li",{className:"cards__item",children:[Object(j.jsx)("img",{className:"cards__image",src:c,alt:n,onClick:function(){return e.onCardClick({name:n,link:c})}}),Object(j.jsx)("h2",{className:"cards__title",children:n}),Object(j.jsxs)("div",{className:"cards__like-container",children:[Object(j.jsx)("button",{className:"cards__button-like ".concat(l?" cards__button-like_active":""),type:"button",onClick:function(){return e.onCardLike(e.data)},"aria-label":"\u041e\u0446\u0435\u043d\u0438\u0442\u044c"}),Object(j.jsx)("span",{className:"cards__like-counter",children:r.length})]}),o&&Object(j.jsx)("button",{className:"button cards__button-delete",type:"button",onClick:function(){return e.onCardDelete(e.data)},"aria-label":"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})},h=n.p+"static/media/header-logo.bbe2a6ea.svg",p={baseUrl:"https://auth.nomoreparties.co"},_="/",f="/sign-in",O="/sign-up",x=function(e){var t=Object(d.g)(),n=Object(a.useContext)(b).currentUser,c=Object(a.useContext)(b).handleLogout,r=e.isMobile,s=e.isInactive,o=e.loggedIn;return Object(j.jsxs)("nav",{className:"header__menu".concat(s&&r?" header__menu_inactive":"").concat(r?" header__menu_mobile":""),children:[o&&Object(j.jsx)("h2",{className:"header__menu-heading",children:n.email}),Object(j.jsx)("ul",{className:"header__menu-links",children:o?Object(j.jsx)("li",{children:Object(j.jsx)("button",{className:"link header__menu-link header__menu-button",onClick:function(){localStorage.removeItem("jwt"),c(),t.push(f)},children:"\u0412\u044b\u0439\u0442\u0438"})}):t.location.pathname===f?Object(j.jsx)("li",{children:Object(j.jsx)(i.b,{className:"link header__menu-link",to:O,children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"})}):Object(j.jsx)("li",{children:Object(j.jsx)(i.b,{className:"link header__menu-link",to:f,children:"\u0412\u043e\u0439\u0442\u0438"})})})]})};var v=function(){var e=Object(a.useContext)(b).loggedIn,t=Object(a.useState)(!1),n=Object(u.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(window.innerWidth<=767),i=Object(u.a)(s,2),o=i[0],l=i[1],d=Object(a.useCallback)((function(){var e=window.innerWidth<=767;e!==o&&l(e)}),[o]);return Object(a.useEffect)((function(){return window.addEventListener("resize",d),function(){return window.removeEventListener("resize",d)}}),[d]),Object(j.jsxs)("header",{className:"header",children:[Object(j.jsxs)("div",{className:"header__containter",children:[Object(j.jsx)("img",{className:"header__logo",src:h,alt:"\u041c\u0435\u0441\u0442\u043e: \u0420\u043e\u0441\u0441\u0438\u044f"}),e?Object(j.jsx)("div",{className:"button header__burger".concat(c?" header__burger_active":""),onClick:function(){r(!c)},children:Object(j.jsx)("span",{className:"header__burger-item".concat(c?" header__burger-item_active":"")})}):Object(j.jsx)(x,{isMobile:!1,isInactive:!1,loggedIn:!1})]}),e&&Object(j.jsx)(x,{isMobile:o,isInactive:!c,loggedIn:e})]})};var g=function(){return Object(j.jsx)("footer",{className:"footer",children:Object(j.jsxs)("p",{className:"footer__copyright",children:["\xa9 ",(new Date).getFullYear()," Mesto Russia"]})})};var C=function(e){var t=e.cards,n=e.onEditProfile,c=e.onAddCard,r=e.onEditAvatar,s=e.onCardClick,i=e.onCardLike,o=e.onCardDelete,l=Object(a.useContext)(b).currentUser,u=Object(a.useContext)(b).loggedIn;return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(v,{loggedIn:u}),Object(j.jsxs)("main",{className:"content",children:[Object(j.jsxs)("section",{className:"profile",children:[Object(j.jsx)("button",{className:"profile__button-edit-avatar",type:"button","aria-label":"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",onClick:r,children:Object(j.jsx)("img",{className:"profile__avatar",src:null===l||void 0===l?void 0:l.avatar,alt:"\u0410\u0432\u0430\u0442\u0430\u0440"})}),Object(j.jsxs)("div",{className:"profile__info",children:[Object(j.jsxs)("div",{className:"profile__container",children:[Object(j.jsx)("h1",{className:"profile__name",children:null===l||void 0===l?void 0:l.name}),Object(j.jsx)("button",{className:"button profile__button-edit-profile",type:"button","aria-label":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",onClick:n})]}),Object(j.jsx)("p",{className:"profile__job",children:null===l||void 0===l?void 0:l.about})]}),Object(j.jsx)("button",{className:"button profile__button-add-card",type:"button","aria-label":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u043e\u0447\u043a\u0443",onClick:c})]}),Object(j.jsx)("section",{className:"cards",children:Object(j.jsx)("ul",{className:"cards__list",children:t.map((function(e){return Object(j.jsx)(m,{data:e,onCardClick:s,onCardLike:i,onCardDelete:o},e._id)}))})})]}),Object(j.jsx)(g,{})]})};var k=function(e){var t=e.card,n=e.onClose;return Object(j.jsx)("section",{className:"popup popup-image popup_theme_black ".concat(t?"popup_opened":""),children:Object(j.jsxs)("div",{className:"popup__container",children:[Object(j.jsxs)("figure",{className:"popup__image-container",children:[Object(j.jsx)("img",{className:"popup__image",src:null===t||void 0===t?void 0:t.link,alt:null===t||void 0===t?void 0:t.name}),Object(j.jsx)("figcaption",{className:"popup__image-caption",children:null===t||void 0===t?void 0:t.name})]}),Object(j.jsx)("button",{className:"button popup__button-close",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:n})]})})};var N=function(e){var t=e.isOpen,n=e.onClose,a=e.onSubmit,c=e.name,r=e.title,s=e.btnSubmitCaption,i=e.children;return Object(j.jsx)("section",{className:"popup popup-".concat(c).concat(t?" popup_opened":""),children:Object(j.jsxs)("div",{className:"popup__container",children:[Object(j.jsxs)("form",{className:"form form-".concat(c),name:"form-".concat(c),onSubmit:a,children:[Object(j.jsx)("h2",{className:"form__heading",children:r}),i,Object(j.jsx)("button",{className:"form__button-submit",type:"submit",children:s})]}),Object(j.jsx)("button",{className:"button popup__button-close",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:n})]})})};var y=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateUser,r=Object(a.useState)(""),s=Object(u.a)(r,2),i=s[0],o=s[1],l=Object(a.useState)(""),d=Object(u.a)(l,2),m=d[0],h=d[1],p=Object(a.useContext)(b).currentUser;return Object(a.useEffect)((function(){o(p.name),h(p.about)}),[p,t]),Object(j.jsxs)(N,{isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),c({name:i,about:m})},name:"profile",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",btnSubmitCaption:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",children:[Object(j.jsx)("input",{className:"form__input",type:"text",name:"profile-name",value:i||"",onChange:function(e){return o(e.target.value)},placeholder:"\u0418\u043c\u044f",minLength:2,maxLength:40,required:!0}),Object(j.jsx)("input",{className:"form__input",type:"text",name:"profile-job",value:m||"",onChange:function(e){return h(e.target.value)},placeholder:"\u041e \u0441\u0435\u0431\u0435",minLength:2,maxLength:200,required:!0})]})};var S=function(e){var t=e.isOpen,n=e.onClose,c=e.onUpdateAvatar,r=Object(a.useRef)();return Object(a.useEffect)((function(){t||(r.current.value="")}),[t]),Object(j.jsx)(N,{isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),c(r.current.value)},name:"avatar",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",btnSubmitCaption:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",children:Object(j.jsx)("input",{className:"form__input",type:"url",name:"avatar-link",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u0430\u0432\u0430\u0442\u0430\u0440",ref:r,required:!0})})};var U=function(e){var t=e.isOpen,n=e.onClose,c=e.onAddCard,r=Object(a.useState)(""),s=Object(u.a)(r,2),i=s[0],o=s[1],l=Object(a.useState)(""),d=Object(u.a)(l,2),b=d[0],m=d[1];return Object(a.useEffect)((function(){t||(o(""),m(""))}),[t]),Object(j.jsxs)(N,{isOpen:t,onClose:n,onSubmit:function(e){e.preventDefault(),c({name:i,link:b})},name:"card",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",btnSubmitCaption:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c",children:[Object(j.jsx)("input",{className:"form__input",type:"text",name:"card-name",value:i||"",onChange:function(e){return o(e.target.value)},placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",minLength:2,maxLength:30,required:!0}),Object(j.jsx)("input",{className:"form__input",type:"url",name:"card-link",value:b||"",onChange:function(e){return m(e.target.value)},placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",required:!0})]})},w=n.p+"static/media/res-success.1b6082f8.svg",E=n.p+"static/media/res-failure.df8eddf6.svg",L=function(e){var t=e.isOpen,n=e.isError,a=e.onClose;return Object(j.jsx)("section",{className:"popup".concat(t?" popup_opened":""),children:Object(j.jsxs)("div",{className:"popup__container",children:[Object(j.jsxs)("div",{className:"tooltip",children:[Object(j.jsx)("img",{className:"tooltip__image",src:n?E:w,alt:n?"\u041e\u0448\u0438\u0431\u043a\u0430":"\u0423\u0441\u043f\u0435\u0445"}),Object(j.jsx)("p",{className:"tooltip__heading",children:n?"\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.":"\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!"})]}),Object(j.jsx)("button",{className:"button popup__button-close",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:a})]})})},I=n(8),A=function(){var e=Object(a.useContext)(b).handleRegister,t=Object(a.useState)({}),n=Object(u.a)(t,2),c=n[0],r=n[1],s=function(e){r(Object(l.a)(Object(l.a)({},c),{},Object(I.a)({},e.target.name,e.target.value)))};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(v,{}),Object(j.jsxs)("section",{className:"register",children:[Object(j.jsxs)("form",{className:"form form_theme_dark",name:"form-register",onSubmit:function(t){t.preventDefault(),e(c)},children:[Object(j.jsx)("h2",{className:"form__heading form__heading_theme_dark",children:"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"}),Object(j.jsx)("input",{className:"form__input form__input_theme_dark",name:"email",type:"email",placeholder:"Email",value:c.email||"",onChange:s,required:!0}),Object(j.jsx)("input",{className:"form__input form__input_theme_dark",name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:8,maxLength:15,value:c.password||"",onChange:s,required:!0}),Object(j.jsx)("button",{className:"form__button-submit form__button-submit_theme_dark",type:"submit",children:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"})]}),Object(j.jsxs)("div",{className:"register__signin",children:[Object(j.jsx)("p",{className:"register__question",children:"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"}),Object(j.jsx)(i.b,{className:"link register__link",to:f,children:"\u0412\u043e\u0439\u0442\u0438"})]})]})]})},H=function(){var e=Object(a.useContext)(b).handleAuthorize,t=Object(a.useState)({}),n=Object(u.a)(t,2),c=n[0],r=n[1],s=function(e){r(Object(l.a)(Object(l.a)({},c),{},Object(I.a)({},e.target.name,e.target.value)))};return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(v,{}),Object(j.jsx)("section",{className:"login",children:Object(j.jsxs)("form",{className:"form form_theme_dark",name:"form-login",onSubmit:function(t){t.preventDefault(),e(c)},children:[Object(j.jsx)("h2",{className:"form__heading form__heading_theme_dark",children:"\u0412\u0445\u043e\u0434"}),Object(j.jsx)("input",{className:"form__input form__input_theme_dark",name:"email",type:"email",placeholder:"Email",value:c.email||"",onChange:s,required:!0}),Object(j.jsx)("input",{className:"form__input form__input_theme_dark",name:"password",type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",minLength:8,maxLength:15,value:c.password||"",onChange:s,required:!0}),Object(j.jsx)("button",{className:"form__button-submit form__button-submit_theme_dark",type:"submit",children:"\u0412\u043e\u0439\u0442\u0438"})]})})]})},T=n(23),D=function(e){var t=e.component,n=Object(T.a)(e,["component"]),a=n.loggedIn;return Object(j.jsx)(d.b,{children:a?Object(j.jsx)(t,Object(l.a)({},n)):Object(j.jsx)(d.a,{to:f})})},P=n(12),q=n(13),z=new(function(){function e(t){Object(P.a)(this,e),this._baseUrl=t.baseUrl,this._headers=t.headers}return Object(q.a)(e,[{key:"_promiseHandler",value:function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}))}},{key:"getUserInfo",value:function(){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}))}},{key:"setUserInfo",value:function(e,t){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}))}},{key:"setUserAvatar",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}))}},{key:"getInitialCards",value:function(){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}))}},{key:"addCard",value:function(e,t){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}))}},{key:"deleteCard",value:function(e){return this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}))}},{key:"changeCardLikeStatus",value:function(e,t){return t?this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers})):this._promiseHandler(fetch("".concat(this._baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}))}}]),e}())({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-26",headers:{authorization:"367be849-b9d8-44df-8a90-129746dbd13f","Content-Type":"application/json"}}),J=new(function(){function e(t){var n=this;Object(P.a)(this,e),this.authorize=function(e,t){return n._promiseHandler(fetch("".concat(p.baseUrl,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}))},this.getContent=function(e){return n._promiseHandler(fetch("".concat(p.baseUrl,"/users/me"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}))},this._baseUrl=t.baseUrl}return Object(q.a)(e,[{key:"_promiseHandler",value:function(e){return e.then((function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))}))}},{key:"register",value:function(e,t){return this._promiseHandler(fetch("".concat(p.baseUrl,"/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}))}}]),e}())(p);var M=function(){var e=Object(d.g)(),t=Object(a.useState)({}),n=Object(u.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)([]),i=Object(u.a)(s,2),m=i[0],h=i[1],p=Object(a.useState)(!1),x=Object(u.a)(p,2),v=x[0],g=x[1],N=Object(a.useState)(!1),w=Object(u.a)(N,2),E=w[0],I=w[1],T=Object(a.useState)(!1),P=Object(u.a)(T,2),q=P[0],M=P[1],F=Object(a.useState)(!1),R=Object(u.a)(F,2),B=R[0],W=R[1],G=Object(a.useState)(null),Y=Object(u.a)(G,2),K=Y[0],Q=Y[1],V=Object(a.useState)(!1),X=Object(u.a)(V,2),Z=X[0],$=X[1],ee=Object(a.useState)(!1),te=Object(u.a)(ee,2),ne=te[0],ae=te[1],ce=function(){g(!1),I(!1),M(!1),W(!1),Q(null)},re=function(e){ae(e),W(!0)},se=Object(a.useCallback)((function(){var t=localStorage.getItem("jwt");if(t){var n=[J.getContent(t),z.getUserInfo(),z.getInitialCards()];Promise.all(n).then((function(t){var n=Object(u.a)(t,3),a=n[0],c=n[1],s=n[2];r(Object(l.a)(Object(l.a)({},c),{},{email:a.data.email})),h(s),$(!0),e.push(_)})).catch((function(){return re(!0)}))}}),[e]);return Object(a.useEffect)((function(){var e=function(e){"Escape"===e.key&&ce()};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[]),Object(a.useEffect)((function(){se()}),[se,e]),Object(j.jsxs)(b.Provider,{value:{currentUser:c,loggedIn:Z,showInfoToolTip:re,handleAuthorize:function(e){var t=e.email,n=e.password;J.authorize(t,n).then((function(e){e.token?(localStorage.setItem("jwt",e.token),se()):re(!0)})).catch((function(){re(!0)}))},handleRegister:function(t){var n=t.email,a=t.password;J.register(n,a).then((function(){e.push(f),re(!1)})).catch((function(){re(!0)}))},handleLogout:function(){return $(!1)}},children:[Object(j.jsxs)(d.d,{children:[Object(j.jsx)(D,{exact:!0,path:_,loggedIn:Z,cards:m,onEditProfile:function(){return g(!0)},onAddCard:function(){return I(!0)},onEditAvatar:function(){return M(!0)},onCardClick:Q,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===c._id}));z.changeCardLikeStatus(e._id,t).then((function(t){h((function(n){return n.map((function(n){return n._id===e._id?t:n}))}))})).catch((function(e){return console.log(e)}))},onCardDelete:function(e){z.deleteCard(e._id).then((function(){h(m.filter((function(t){return t._id!==e._id})))})).catch((function(e){return console.log(e)}))},component:C}),Object(j.jsx)(d.b,{exact:!0,path:O,children:Z?Object(j.jsx)(d.a,{to:_}):Object(j.jsx)(A,{})}),Object(j.jsx)(d.b,{exact:!0,path:f,children:Z?Object(j.jsx)(d.a,{to:_}):Object(j.jsx)(H,{})})]}),Object(j.jsx)(y,{isOpen:v,onClose:ce,onUpdateUser:function(e){var t=e.name,n=e.about;z.setUserInfo(t,n).then((function(e){r(Object(l.a)(Object(l.a)({},c),e)),ce()})).catch((function(e){return console.log(e)}))}}),Object(j.jsx)(U,{isOpen:E,onClose:ce,onAddCard:function(e){var t=e.name,n=e.link;z.addCard(t,n).then((function(e){h([e].concat(Object(o.a)(m))),ce()})).catch((function(e){return console.log(e)}))}}),Object(j.jsx)(S,{isOpen:q,onClose:ce,onUpdateAvatar:function(e){z.setUserAvatar(e).then((function(e){r(Object(l.a)(Object(l.a)({},c),e)),ce()})).catch((function(e){return console.log(e)}))}}),Object(j.jsx)(k,{card:K,onClose:ce}),Object(j.jsx)(L,{isOpen:B,isError:ne,onClose:ce})]})};s.a.render(Object(j.jsx)(c.a.StrictMode,{children:Object(j.jsx)(i.a,{children:Object(j.jsx)(M,{})})}),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.288744c4.chunk.js.map